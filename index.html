<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BE Playsound List</title>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DNYVPBW6JQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-DNYVPBW6JQ');
  </script>

  <!-- SEO Meta Tags -->
  <meta name="title" content="BE Playsound List - Minecraft Bedrock Edition Sound Library">
  <meta name="description" content="Explore and listen to every sound event available in Minecraft Bedrock Edition. Search, preview, and learn the exact sound names for use in your projects or commands.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://playsoundlist.xyz/">

  <!-- Open Graph -->
  <meta property="og:title" content="BE Playsound List - Minecraft Bedrock Edition Sound Library">
  <meta property="og:description" content="A complete searchable sound library for Minecraft Bedrock Edition â€” listen to all playsound events directly in your browser.">
  <meta property="og:image" content="https://playsoundlist.xyz/assets/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://playsoundlist.xyz/">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="BE Playsound List - Minecraft Bedrock Edition Sound Library">
  <meta name="twitter:image" content="https://playsoundlist.xyz/assets/og-image.png">

  <style>
    :root { --bg:#111; --panel:#1a1a1a; --line:#2c2c2c; --muted:#aaa; --fg:#eee; --accent:#16a34a; }
    html,body{margin:0;padding:0;background:#111;color:#eee;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
    .wrap{max-width:960px;margin:0 auto;padding:18px;}
    h1{margin:8px 0 18px;text-align:center;color:#90caf9;font-weight:800;letter-spacing:.5px}

    .toolbar{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
    .search{flex:1 1 440px;max-width:560px}
    .search input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#222;color:var(--fg);outline:none}

    .pagesize select{padding:9px 10px;border-radius:10px;background:#222;border:1px solid var(--line);color:var(--fg)}

    .pager{display:flex;gap:8px;align-items:center;justify-content:center;margin:8px 0 14px}
    .muted{color:var(--muted);font-size:.92rem}

    .list{display:flex;flex-direction:column;gap:12px;margin-bottom:40px}

    .card{background:#1a1a1a;border:1px solid var(--line);border-radius:14px;padding:12px 14px;position:relative}
    .title{font-weight:700;margin-bottom:8px;word-break:break-word}

    .distanceTag{
      position:absolute;
      right:12px;
      top:12px;
      color:#8bc34a;
      font-size:0.85rem;
      font-weight:700;
    }

    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin:6px 0}
    .label{color:var(--muted)}
    input[type="range"]{width:240px}

    button{cursor:pointer}
    .btn{padding:6px 12px;border-radius:10px;border:1px solid var(--line);background:#2b2b2b;color:#eee}
    .btn:hover{background:#3a3a3a}
    .btn.play.playing{background:var(--accent);border-color:var(--accent);color:#000}

    .btn.disabled{
      background:#552222;
      border-color:#772222;
      color:#ffaaaa;
      cursor:not-allowed;
    }
  </style>
</head>

<body>
<div class="wrap">
  <h1>BE Playsound List</h1>

  <div class="toolbar">
    <div class="search"><input id="q" type="text" placeholder="Search sounds (ex: beacon.pow, ui.loom ...)" /></div>
    <div class="pagesize">
      <select id="pagesize">
        <option>25</option><option>50</option><option selected>100</option><option>200</option>
      </select>
    </div>
  </div>

  <div class="pager">
    <button id="prev" class="btn">&lt; Prev</button>
    <div id="pageinfo" class="muted"></div>
    <button id="next" class="btn">Next &gt;</button>
  </div>

  <div id="count" class="muted" style="text-align:center;margin-bottom:10px;"></div>
  <div id="list" class="list"></div>
</div>

<script>
  /* ===============================
   Configuration
================================*/
const GH_BASE = 'https://1309-boy.github.io/playsoundlist';
const MANIFEST_URL    = `${GH_BASE}/manifest.json`;
const DEFINITIONS_URL = `${GH_BASE}/sound_definitions.json`;

/* ===============================
   Global State
================================*/
const state = {
  items: [],
  filtered: [],
  itemsByName: new Map(),
  manifestSet: new Set(),
  page: 0,
  pageSize: 100,
};

const playIndex = {}; 
let currentKey = null;
let currentPlayBtn = null;

/* Audio */
let webCtx = null;
let audioUnlocked = false;
let currentSrcNode = null;
const bufferCache = new Map();

/* DOM */
const $list   = document.getElementById('list');
const $count  = document.getElementById('count');
const $q      = document.getElementById('q');
const $pageinfo = document.getElementById('pageinfo');
const $prev   = document.getElementById('prev');
const $next   = document.getElementById('next');
const $pagesize = document.getElementById('pagesize');

/* ===============================
   Helper Functions
================================*/
function normalizeDefSound(s){
  if(!s) return null;
  if(typeof s === 'string') return {name:s};
  if(s.name) return {name:s.name};
  return null;
}

function soundToBasePath(s){ return s.replace(/^sounds\//,''); }
function baseToUrl(base){ return `${GH_BASE}/sounds_flat/${base}.wav`; }

function inManifest(url){
  if(state.manifestSet.has(url)) return true;

  const rel = url.replace(`${GH_BASE}/`,'');
  if(state.manifestSet.has(rel)) return true;

  const onlyPath = url.replace(/^https?:\/\/[^/]+\//,'');
  return state.manifestSet.has(onlyPath);
}

/* ===============================
   Distance Calculation
================================*/
function calcDistance(def){
  const maxD = def.max_distance;
  let vol = 1.0;

  if(def.sounds && def.sounds.length && def.sounds[0].volume){
    vol = def.sounds[0].volume;
  }

  if(maxD && maxD > 0){
    return Math.max( vol * 16, 16 );
  }
  return Math.max( vol * 16, 16 );
}

/* ===============================
   Rendering UI
================================*/
function fmtPage(){
  const total = state.filtered.length;
  const pages = Math.max(1, Math.ceil(total / state.pageSize));
  const page  = Math.min(state.page + 1, pages);
  $pageinfo.textContent = `Page ${page} / ${pages}`;
}

function render(){
  $list.innerHTML = '';

  const start = state.page * state.pageSize;
  const end   = Math.min(start + state.pageSize, state.filtered.length);
  const items = state.filtered.slice(start, end);

  for(const item of items){
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.key = item.name;

    const distLabel = (item.distance === null)
      ? `distance: n/a`
      : `distance: ${item.distance}`;

    const hasAudio = item.files.length > 0;

    card.innerHTML = `
      <div class="distanceTag">${distLabel}</div>
      <div class="title">${item.name}</div>

      <div class="row">
        <button class="btn play ${hasAudio ? '' : 'disabled'}">${
          hasAudio ? 'Play' : 'ðŸš«'
        }</button>
        <button class="btn stop ${hasAudio ? '' : 'disabled'}">Stop</button>
      </div>

      <div class="row">
        <span class="label">Pitch:</span>
        <input class="pitch" type="range" min="0.1" max="2.0" step="0.1" value="1.0"/>
        <span class="pitch-val">1.0</span>
      </div>
    `;

    $list.appendChild(card);
  }

  $count.textContent = `Showing ${start+1}-${end} of ${state.filtered.length}`;
  fmtPage();
}

/* ===============================
   Events
================================*/
$q.addEventListener('input', applyFilter);

$pagesize.addEventListener('change', ()=>{
  state.pageSize = parseInt($pagesize.value,10);
  state.page = 0;
  render();
});

$prev.addEventListener('click', ()=>{
  if(state.page > 0){
    state.page--;
    render();
  }
});

$next.addEventListener('click', ()=>{
  const pages = Math.ceil(state.filtered.length / state.pageSize);
  if(state.page < pages-1){
    state.page++;
    render();
  }
});

document.addEventListener('input', (e)=>{
  if(!e.target.matches('.pitch')) return;
  const card = e.target.closest('.card');
  const key  = card?.dataset?.key;
  card.querySelector('.pitch-val').textContent = e.target.value;

  if(currentSrcNode && currentKey === key){
    currentSrcNode.playbackRate.value = parseFloat(e.target.value);
  }
});

document.addEventListener('click', (e)=>{
  const btnPlay = e.target.closest('.btn.play');
  if(btnPlay){
    const card = btnPlay.closest('.card');
    const key = card.dataset.key;
    if(btnPlay.classList.contains('disabled')){
      alert("This sound file is not available.\n(ìŒì›ì´ ì œê³µë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)");
      return;
    }
    playKey(key, btnPlay);
    return;
  }

  const btnStop = e.target.closest('.btn.stop');
  if(btnStop){
    const card = btnStop.closest('.card');
    const key = card.dataset.key;
    stopKey(key);
  }
});

/* ===============================
   Unlock Audio
================================*/
['pointerdown','touchstart','keydown','mousedown'].forEach(evt=>{
  window.addEventListener(evt, unlockAudio, {once:true, passive:true});
});

async function unlockAudio(){
  try{
    const AC = window.AudioContext || window.webkitAudioContext;
    if(AC && !webCtx){
      webCtx = new AC();
    }
    if(webCtx && webCtx.state === 'suspended'){
      await webCtx.resume();
    }
    audioUnlocked = true;
  }catch(err){}
}

/* ===============================
   WebAudio helpers
================================*/
async function getBuffer(url){
  if(bufferCache.has(url)) return bufferCache.get(url);
  const r = await fetch(url, {cache:'force-cache'});
  if(!r.ok) throw new Error("Audio fetch failed");
  const ab = await r.arrayBuffer();
  const buf = await webCtx.decodeAudioData(ab);
  bufferCache.set(url, buf);
  return buf;
}

function stopCurrent(){
  if(currentSrcNode){
    try{ currentSrcNode.stop(0); }catch(_){}
    currentSrcNode.disconnect?.();
  }
  if(currentPlayBtn){
    currentPlayBtn.classList.remove('playing');
  }
  currentSrcNode = null;
  currentPlayBtn = null;
  currentKey = null;
}

/* ===============================
   Play / Stop Logic
================================*/
function nextUrlFor(key){
  const item = state.itemsByName.get(key);
  if(!item || !item.files.length) return null;

  const idx = ((playIndex[key] || 0) % item.files.length);
  playIndex[key] = idx + 1;

  return baseToUrl(item.files[idx]);
}

async function playKey(key, btn){
  const url = nextUrlFor(key);
  if(!url){
    alert("This sound file is not available.");
    return;
  }

  await unlockAudio();
  if(!webCtx) await unlockAudio();

  stopCurrent();

  const card = document.querySelector(`.card[data-key="${CSS.escape(key)}"]`);
  const rate = parseFloat(card.querySelector('.pitch').value || "1.0");

  try{
    const buf = await getBuffer(url);
    const src = webCtx.createBufferSource();
    src.buffer = buf;
    src.playbackRate.value = rate;
    src.connect(webCtx.destination);

    currentSrcNode = src;
    currentKey = key;
    currentPlayBtn = btn;

    btn.classList.add('playing');
    src.onended = ()=> stopCurrent();
    src.start(0);
  }catch(err){
    stopCurrent();
  }
}

function stopKey(key){
  if(currentSrcNode && currentKey === key){
    stopCurrent();
  }
}

/* ===============================
   Filtering
================================*/
function applyFilter(){
  const q = ($q.value || "").toLowerCase().trim();
  state.filtered = !q ? state.items.slice()
                      : state.items.filter(it => it.name.toLowerCase().includes(q));
  state.page = 0;
  render();
}

/* ===============================
   Load manifest + definitions
================================*/
async function loadManifest(){
  const r = await fetch(MANIFEST_URL, {cache:"no-store"});
  const j = await r.json();

  let urls = [];
  if(Array.isArray(j)) urls = j;
  else if(j.urls) urls = j.urls;
  else if(j.entries) urls = j.entries.map(e=>e.url);

  const s = new Set();
  for(const u of urls){
    if(!u) continue;
    s.add(u);
    const rel = u.replace(`${GH_BASE}/`, '');
    s.add(rel);
    const onlyPath = u.replace(/^https?:\/\/[^/]+\//,'');
    s.add(onlyPath);
  }
  state.manifestSet = s;
}

async function loadDefinitions(){
  const r = await fetch(DEFINITIONS_URL, {cache:"no-store"});
  const defsAll = await r.json();
  const defs = defsAll.sound_definitions || defsAll;

  let items = [];
  let map = new Map();

  for(const [key, def] of Object.entries(defs)){
    if(!def || !Array.isArray(def.sounds)) continue;

    const files = def.sounds
      .map(normalizeDefSound)
      .filter(Boolean)
      .map(s => soundToBasePath(s.name))
      .filter(base => inManifest(baseToUrl(base)));

    const distance = calcDistance(def);

    const item = {
      name: key,
      files,
      distance
    };
    items.push(item);
    map.set(key, item);
  }

  items.sort((a,b) => a.name.localeCompare(b.name));

  state.items = items;
  state.itemsByName = map;
  state.filtered = items.slice();
}

/* ===============================
   Init
================================*/
(async function init(){
  await loadManifest();
  await loadDefinitions();
  render();
})();
</script>

</body>
</html>
